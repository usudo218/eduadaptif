<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - ELANG DIGITAL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --warna-utama: #1e293b;
            --warna-aksen: #4f46e5;
            --warna-latar: #f8fafc;
            --warna-teks: #334155;
            --warna-sukses: #10b981;
            --warna-bahaya: #ef4444;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--warna-latar); color: var(--warna-teks); margin: 0; padding: 20px; }
        
        .admin-container { 
            background: white; 
            max-width: 1250px; 
            margin: 20px auto; 
            border-radius: 16px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
            padding: 30px;
        }

        .login-box { text-align: center; padding: 60px 20px; }
        .Pak-Agus-admin { width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--warna-aksen); margin-bottom: 20px; }
        
        .header-dashboard { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .filter-section {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
            margin-bottom: 25px;
        }

        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        select, input[type="password"] { 
            padding: 10px; 
            border-radius: 8px; 
            border: 1px solid #cbd5e1; 
            background: white; 
            font-size: 0.9rem;
        }

        .table-responsive { overflow-x: auto; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--warna-utama); color: white; padding: 15px; text-align: left; }
        td { padding: 12px 15px; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; }

        .badge { padding: 5px 10px; border-radius: 6px; font-weight: bold; font-size: 0.7rem; }
        .tuntas { background: #dcfce7; color: #166534; }
        .remedial { background: #fee2e2; color: #991b1b; }

        .btn { border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; color: white; }
        .btn-primary { background: var(--warna-aksen); }
        .btn-success { background: var(--warna-sukses); margin-left: 10px; }
        .btn:hover { opacity: 0.8; transform: translateY(-1px); }

        .footer { text-align: center; margin-top: 30px; font-size: 0.8rem; color: #94a3b8; }
    </style>
</head>
<body>

<div class="admin-container">
    <div id="area-login" class="login-box">
        <img src="images/Pak-Agus.png" alt="Pak Agus Admin" class="Pak-Agus-admin">
        <h2>Akses Monitoring Elang Digital</h2>
        <input type="password" id="pass-admin" placeholder="Kode Keamanan Admin" style="width: 250px;"><br><br>
        <button class="btn btn-primary" onclick="cekLogin()">Masuk Dashboard</button>
    </div>

    <div id="area-dashboard" style="display:none;">
        <div class="header-dashboard">
            <div>
                <h1 style="margin:0; font-size: 1.4rem;">Monitoring Progres Siswa</h1>
                <p style="margin: 5px 0 0; opacity: 0.7; font-size: 0.9rem;">SMA Negeri 1 Muncar &copy; 2026</p>
            </div>
            <div>
                <button class="btn btn-primary" onclick="tarikData()">üîÑ Refresh Data</button>
                <button class="btn btn-success" onclick="unduhExcel()">üì• Ekspor Excel</button>
            </div>
        </div>

        <div class="filter-section">
            <div class="filter-group">
                <label>Filter Kelas:</label>
                <select id="f-kelas" onchange="filterData()">
                    <option value="SEMUA">-- Semua Kelas --</option>
                    <option value="KELAS 10-1">KELAS 10-1</option>
                    <option value="KELAS 10-2">KELAS 10-2</option>
                    <option value="KELAS 10-3">KELAS 10-3</option>
                    <option value="KELAS 10-4">KELAS 10-4</option>
                    <option value="KELAS 10-5">KELAS 10-5</option>
                    <option value="KELAS 10-6">KELAS 10-6</option>
                    <option value="KELAS 10-7">KELAS 10-7</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Filter Modul:</label>
                <select id="f-modul" onchange="filterData()">
                    <option value="SEMUA">-- Semua Modul --</option>
                    <option value="BK">BK (Berpikir Komputasi)</option>
                    <option value="TIK">TIK (Office)</option>
                    <option value="SK">SK (Hardware/Software)</option>
                    <option value="JKI">JKI (Jaringan)</option>
                    <option value="AD">AD (Analisis Data)</option>
                    <option value="AP">AP (Pemrograman)</option>
                    <option value="DSI">DSI (Dampak Sosial)</option>
                    <option value="PLB">PLB (Proyek)</option>
                </select>
            </div>
            <div style="margin-left: auto; text-align: right; align-self: center;">
                <b id="count-data" style="color: var(--warna-aksen);">Ditemukan: 0 Data</b>
            </div>
        </div>

        <div class="table-responsive">
            <table id="tabel-siswa">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Nama Siswa</th>
                        <th>Kelas</th>
                        <th>Modul</th>
                        <th>Skor</th>
                        <th>Bantuan</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="tbody-data">
                    <tr><td colspan="7" style="text-align:center">Data belum dimuat.</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="footer">
    Dikembangkan oleh <b>Agus Suyatno, S.Kom</b>
</div>

<script>
    const KEY_ADMIN = "ADMIN2026";
    // GANTI URL DI BAWAH DENGAN URL APPS SCRIPT ANDA
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzgcZKAlz7gOP2uEz9fHhpspj726hqYP1F7nYo8FQybaY_cStqxiZ7YA8NNQ0CMdLrV/exec";

    let masterData = [];

    function cekLogin() {
        if(document.getElementById('pass-admin').value === KEY_ADMIN) {
            document.getElementById('area-login').style.display = 'none';
            document.getElementById('area-dashboard').style.display = 'block';
            tarikData();
        } else {
            alert("Kode salah!");
        }
    }

    async function tarikData() {
        const body = document.getElementById('tbody-data');
        body.innerHTML = "<tr><td colspan='7' style='text-align:center'>‚è≥ Sedang sinkronisasi data...</td></tr>";
        
        try {
            const res = await fetch(SCRIPT_URL + "?action=readData");
            const rawData = await res.json();
            masterData = rawData.slice(1); // Potong header
            filterData();
        } catch (e) {
            body.innerHTML = "<tr><td colspan='7' style='text-align:center; color:red;'>‚ö†Ô∏è Error: Gagal menarik data. Pastikan Web App sudah di-deploy sebagai 'Anyone'.</td></tr>";
        }
    }

    function filterData() {
        const kls = document.getElementById('f-kelas').value;
        const mdl = document.getElementById('f-modul').value;
        const filtered = masterData.filter(r => {
            const kCek = (kls === "SEMUA" || r[2] === kls);
            const mCek = (mdl === "SEMUA" || r[3].includes(mdl));
            return kCek && mCek;
        });
        render(filtered);
    }

    function render(data) {
        const body = document.getElementById('tbody-data');
        body.innerHTML = "";
        document.getElementById('count-data').innerText = `Ditemukan: ${data.length} Data`;

        if(data.length === 0) {
            body.innerHTML = "<tr><td colspan='7' style='text-align:center'>Data tidak ditemukan.</td></tr>";
            return;
        }

        data.forEach(r => {
            const st = r[6] === "TUNTAS" ? "tuntas" : "remedial";
            body.innerHTML += `
                <tr>
                    <td>${r[0]}</td>
                    <td><b>${r[1]}</b></td>
                    <td>${r[2]}</td>
                    <td>${r[3]}</td>
                    <td style="font-weight:bold">${r[4]}</td>
                    <td>${r[5]} kali</td>
                    <td><span class="badge ${st}">${r[6]}</span></td>
                </tr>
            `;
        });
    }

    function unduhExcel() {
        const tbl = document.getElementById('tabel-siswa');
        const wb = XLSX.utils.table_to_book(tbl, {sheet: "Rekap Nilai"});
        XLSX.writeFile(wb, `Rekap_Nilai_ElangDigital_2026.xlsx`);
    }
</script>
</body>
</html>
