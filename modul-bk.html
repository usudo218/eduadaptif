<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modul BK - ELANG DIGITAL</title>
    <style>
        :root {
            --warna-utama: #E11D48; /* Crimson untuk BK */
            --warna-merah: #EF4444; 
            --warna-merah-hover: #DC2626;
            --warna-latar: #F3F4F6; 
            --warna-teks: #1F2937;  
            --latar-mentor: #FFE4E6; 
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--warna-latar); display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; margin: 0; padding: 20px; color: var(--warna-teks); }
        .app-container { background: white; width: 100%; max-width: 650px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; margin-top: 20px; display: flex; flex-direction: column;}
        
        .header { background: var(--warna-utama); color: white; padding: 50px 20px 30px 20px; text-align: center; position: relative; }
        .header h1 { margin: 0; font-size: 1.6rem; font-weight: 700; }
        
        /* TOMBOL HEADER SERAGAM */
        .btn-header { 
            position: absolute; top: 15px; display: flex; align-items: center; justify-content: center;
            gap: 6px; font-size: 0.85rem; font-weight: 600; height: 36px; width: 100px;
            border-radius: 8px; text-decoration: none; color: white; border: 1px solid rgba(255, 255, 255, 0.4); 
            cursor: pointer; background: rgba(255, 255, 255, 0.15); transition: 0.3s;
        }
        .btn-header:hover { background: white; color: var(--warna-utama); }
        .home-pos { left: 15px; } .logout-pos { right: 15px; }

        .content { padding: 25px 20px; flex-grow: 1; }
        .login-card { background: white; padding: 30px 25px; border-radius: 20px; text-align: center; border: 1px solid #E5E7EB; }
        .pak-cokro-img { width: 110px; height: 110px; border-radius: 50%; border: 3px solid var(--warna-utama); margin-bottom: 15px; object-fit: cover; }
        select { width: 100%; padding: 15px; border: 2px solid #E5E7EB; border-radius: 12px; font-size: 1rem; margin-bottom: 15px; font-weight: 600; cursor: pointer; }

        .mentor-box { display: flex; gap: 15px; background: var(--latar-mentor); padding: 15px; border-radius: 12px; margin-bottom: 25px; border-left: 5px solid var(--warna-utama); align-items: center; }
        .mentor-avatar { width: 65px; height: 65px; border-radius: 50%; overflow: hidden; border: 2px solid var(--warna-utama); background: white; flex-shrink: 0;}
        .mentor-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .mentor-name { font-weight: bold; color: var(--warna-utama); display: block; }

        .area-konten { display: none; }
        .area-aktif { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .teks-materi { background: #f9fafb; padding: 25px; border-radius: 12px; border: 1px solid #e5e7eb; height: 450px; overflow-y: auto; text-align: justify; line-height: 1.7; }
        .teks-materi h3 { color: var(--warna-utama); border-bottom: 2px solid #eee; padding-bottom: 8px; margin-top: 25px; }

        .btn-opsi { background: white; border: 2px solid #D1D5DB; padding: 15px; border-radius: 8px; text-align: left; font-size: 1rem; cursor: pointer; width: 100%; margin-bottom: 10px; }
        .btn-opsi.terpilih { background: var(--latar-mentor); border-color: var(--warna-utama); font-weight: bold; color: var(--warna-utama); }

        .btn-action { width: 100%; background: var(--warna-utama); color: white; border: none; padding: 15px; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-bottom: 10px; transition: 0.2s; }
        .btn-submit { background: #10B981; }

        /* Tombol PDF Merah */
        .pdf-box { background: #FFF1F2; padding: 18px; border-radius: 12px; border: 1px dashed var(--warna-utama); margin-top: 20px; text-align: center; }
        .btn-pdf-merah { background: var(--warna-merah) !important; color: white !important; text-decoration: none; display: inline-block; padding: 12px 25px; border-radius: 8px; font-weight: bold; }

        .angka-skor { font-size: 4.5rem; font-weight: bold; color: var(--warna-utama); text-align: center; margin: 10px 0;}
        .nama-hasil { font-size: 1.2rem; font-weight: 800; color: var(--warna-teks); text-align: center; text-transform: uppercase; }
        .footer { background-color: #f9fafb; color: #6b7280; text-align: center; padding: 20px; font-size: 0.85rem; border-top: 1px solid #e5e7eb; }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <a href="index.html" class="btn-header home-pos">üè† Home</a>
            <button id="btn-logout" class="btn-header logout-pos" onclick="logout()" style="display: none;">üö™ Logout</button>
            <h1>Modul BK</h1>
        </div>
        <div class="content">
            <div id="area-login" class="area-konten area-aktif">
                <div class="login-card">
                    <img src="images/pak-cokro.png" alt="Pak Agus" class="pak-cokro-img">
                    <h2>Halo Programmer!</h2>
                    <select id="pilih-kelas" onchange="filterNama()"><option value="">-- Pilih Kelas --</option></select>
                    <select id="pilih-nama" disabled><option value="">-- Pilih Nama --</option></select>
                    <button class="btn-action btn-submit" onclick="login()">üß† Mulai Belajar</button>
                </div>
            </div>
            <div id="area-mentor-global" style="display: none;">
                <div class="mentor-box">
                    <div class="mentor-avatar"><img src="images/pak-cokro.png" alt="Pak Agus"></div>
                    <div class="mentor-message"><span class="mentor-name">Pak Agus :</span><span id="pesan-mentor">...</span></div>
                </div>
            </div>
            <div id="area-materi" class="area-konten">
                <div class="teks-materi">
                    <h3>Berpikir Komputasional (BK)</h3>
                    <p>Berpikir komputasional adalah ilmu untuk menyelesaikan masalah secara efisien, efektif, dan optimal agar solusinya bisa dijalankan manusia maupun mesin.</p>
                    <div class="pdf-box">
                        <p style="margin-bottom: 12px; font-weight: bold;">üìñ Ingin membaca naskah materi lengkap?</p>
                        <a href="https://drive.google.com/file/d/1JnEyi4GkRpT8bV6PO1mQIMtVnX_lQJRB/view?usp=sharing" target="_blank" class="btn-pdf-merah">üì• Buka Naskah Materi (PDF)</a>
                    </div>
                </div>
                <button class="btn-action" onclick="startKuis()">Logika Siap, Mulai Kuis!</button>
            </div>
            <div id="area-kuis" class="area-konten">
                <h4 id="indikator">Soal 1</h4>
                <h2 id="teks-soal" style="font-size: 1.1rem; min-height: 60px;">Memuat...</h2>
                <div id="container-opsi"></div>
                <button id="btn-lanjut" class="btn-action" onclick="next()" disabled style="opacity:0.5">Pilih Jawaban Dulu</button>
            </div>
            <div id="area-hasil" class="area-konten">
                <div id="res-nama" class="nama-hasil"></div>
                <div class="angka-skor" id="res-skor">0</div>
                <p id="res-status" style="text-align:center; font-weight:bold; font-size:1.2rem;"></p>
                <button class="btn-action btn-submit" onclick="location.href='index.html'">‚úÖ Selesai</button>
            </div>
        </div>
        <div class="footer">Design by <b>Agus Suyatno, S.Kom</b><br>&copy; 2026 SMA Negeri 1 Muncar</div>
    </div>

    <script src="soal-bk.js"></script>
    <script src="siswa.js"></script>
    <script>
        let userN="", userK="", qList=[], qIdx=0, score=0, sel=null;
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzgcZKAlz7gOP2uEz9fHhpspj726hqYP1F7nYo8FQybaY_cStqxiZ7YA8NNQ0CMdLrV/exec";

        function save() { localStorage.setItem('pro_bk', JSON.stringify({n:userN, k:userK, i:qIdx, s:score, list:qList, f:curF})); }
        let curF = 'login';

        window.onload = function() {
            const p = JSON.parse(localStorage.getItem('pro_bk'));
            if(p) {
                userN=p.n; userK=p.k; qIdx=p.i; score=p.s; qList=p.list; curF=p.f;
                document.getElementById('area-mentor-global').style.display="block";
                document.getElementById('btn-logout').style.display="flex";
                if(curF==='materi') showMateri(); else loadQ();
            } else initDrop();
        };

        function initDrop() {
            const sk = document.getElementById('pilih-kelas');
            [...new Set(SISWA_BARU.map(x=>x.kelas))].sort().forEach(k=>{let o=document.createElement('option');o.value=k;o.innerText=k;sk.appendChild(o);});
        }
        function filterNama() {
            const k=document.getElementById('pilih-kelas').value; const sn=document.getElementById('pilih-nama'); sn.innerHTML='<option value="">-- Pilih Nama --</option>';
            if(!k) return sn.disabled=true; sn.disabled=false;
            SISWA_BARU.filter(x=>x.kelas===k).forEach(x=>{let o=document.createElement('option');o.value=x.nama;o.innerText=x.nama;sn.appendChild(o);});
        }
        function login() {
            userN=document.getElementById('pilih-nama').value; userK=document.getElementById('pilih-kelas').value;
            if(!userN) return alert("Pilih Nama!");
            document.getElementById('area-mentor-global').style.display="block";
            document.getElementById('btn-logout').style.display="flex";
            showMateri();
        }
        function showMateri() { curF='materi'; hideAll(); document.getElementById('area-materi').style.display='block'; document.getElementById('pesan-mentor').innerText=`Halo ${userN}, ayo pelajari materinya!`; save(); }
        function startKuis() { qList=[...daftarSoalAsli].sort(()=>Math.random()-0.5); qIdx=0; score=0; loadQ(); }
        function loadQ() {
            curF='kuis'; hideAll(); document.getElementById('area-kuis').style.display='block'; sel=null;
            let q = qList[qIdx]; document.getElementById('indikator').innerText=`Soal ${qIdx+1}/${qList.length}`;
            document.getElementById('teks-soal').innerText=q.p;
            const bl=document.getElementById('btn-lanjut'); bl.disabled=true; bl.style.opacity="0.5";
            const co=document.getElementById('container-opsi'); co.innerHTML='';
            q.o.forEach((t,i)=>{
                const b=document.createElement('button'); b.className='btn-opsi'; b.innerText=t;
                b.onclick=()=>{document.querySelectorAll('.btn-opsi').forEach(x=>x.classList.remove('terpilih')); b.classList.add('terpilih'); sel=i; bl.disabled=false; bl.style.opacity="1";};
                co.appendChild(b);
            });
            save();
        }
        function next() { if(sel===qList[qIdx].k) score++; qIdx++; if(qIdx<qList.length) loadQ(); else showResult(); }
        function showResult() {
            hideAll(); document.getElementById('area-hasil').style.display='block';
            let final = Math.round((score/qList.length)*100);
            document.getElementById('res-nama').innerText=userN; document.getElementById('res-skor').innerText=final;
            document.getElementById('res-status').innerText=final>=100?"TUNTAS":"REMEDIAL";
            fetch(GAS_URL+"?"+new URLSearchParams({namaSiswa:userN, kelasSiswa:userK, modul:"BK", skor:final}),{mode:'no-cors'});
            localStorage.removeItem('pro_bk');
        }
        function hideAll() { document.querySelectorAll('.area-konten').forEach(a=>a.style.display='none'); }
        function logout() { if(confirm("Logout?")) { localStorage.removeItem('pro_bk'); location.reload(); } }
    </script>
</body>
</html>
